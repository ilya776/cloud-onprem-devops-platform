Index: terraform/main.tf
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>module \"vpc\" {\n  source          = \"./aws-vpc\"\n  project         = \"cloud-onprem\"\n  vpc_cidr        = \"10.0.0.0/16\"\n  public_subnets  = [\"10.0.1.0/24\", \"10.0.2.0/24\"]\n  private_subnets = [\"10.0.101.0/24\", \"10.0.102.0/24\"]\n  azs             = [\"us-east-1a\", \"us-east-1b\"]\n}\nmodule \"eks\" {\n  source          = \"./aws-eks\"\n  vpc_id          = module.vpc.vpc_id\n  private_subnets = module.vpc.private_subnets\n}\n\nmodule \"bastion\" {\n  source            = \"./aws-bastion\"\n  vpc_id            = module.vpc.vpc_id\n  public_subnet_id  = module.vpc.public_subnets[0]\n  my_ip             = \"193.109.145.16/32\"\n}\nprovider \"aws\" {\n  region = \"us-east-1\"\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/terraform/main.tf b/terraform/main.tf
--- a/terraform/main.tf	(revision 5710a9eeb899bce28b058b8b13972471fbc5b073)
+++ b/terraform/main.tf	(date 1745163297068)
@@ -13,10 +13,10 @@
 }
 
 module "bastion" {
-  source            = "./aws-bastion"
-  vpc_id            = module.vpc.vpc_id
-  public_subnet_id  = module.vpc.public_subnets[0]
-  my_ip             = "193.109.145.16/32"
+  source           = "./aws-bastion"
+  vpc_id           = module.vpc.vpc_id
+  public_subnet_id = module.vpc.public_subnets[0]
+  my_ip            = "193.109.145.16/32"
 }
 provider "aws" {
   region = "us-east-1"
Index: terraform/.terraform/modules/modules.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{\"Modules\":[{\"Key\":\"\",\"Source\":\"\",\"Dir\":\".\"},{\"Key\":\"bastion\",\"Source\":\"./aws-bastion\",\"Dir\":\"aws-bastion\"},{\"Key\":\"eks\",\"Source\":\"./aws-eks\",\"Dir\":\"aws-eks\"},{\"Key\":\"eks.eks\",\"Source\":\"registry.terraform.io/terraform-aws-modules/eks/aws\",\"Version\":\"20.8.4\",\"Dir\":\".terraform/modules/eks.eks\"},{\"Key\":\"eks.eks.eks_managed_node_group\",\"Source\":\"./modules/eks-managed-node-group\",\"Dir\":\".terraform/modules/eks.eks/modules/eks-managed-node-group\"},{\"Key\":\"eks.eks.eks_managed_node_group.user_data\",\"Source\":\"../_user_data\",\"Dir\":\".terraform/modules/eks.eks/modules/_user_data\"},{\"Key\":\"eks.eks.fargate_profile\",\"Source\":\"./modules/fargate-profile\",\"Dir\":\".terraform/modules/eks.eks/modules/fargate-profile\"},{\"Key\":\"eks.eks.kms\",\"Source\":\"registry.terraform.io/terraform-aws-modules/kms/aws\",\"Version\":\"2.1.0\",\"Dir\":\".terraform/modules/eks.eks.kms\"},{\"Key\":\"eks.eks.self_managed_node_group\",\"Source\":\"./modules/self-managed-node-group\",\"Dir\":\".terraform/modules/eks.eks/modules/self-managed-node-group\"},{\"Key\":\"eks.eks.self_managed_node_group.user_data\",\"Source\":\"../_user_data\",\"Dir\":\".terraform/modules/eks.eks/modules/_user_data\"},{\"Key\":\"vpc\",\"Source\":\"./aws-vpc\",\"Dir\":\"aws-vpc\"}]}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/terraform/.terraform/modules/modules.json b/terraform/.terraform/modules/modules.json
--- a/terraform/.terraform/modules/modules.json	(revision 5710a9eeb899bce28b058b8b13972471fbc5b073)
+++ b/terraform/.terraform/modules/modules.json	(date 1745164884117)
@@ -1,1 +1,1 @@
-{"Modules":[{"Key":"","Source":"","Dir":"."},{"Key":"bastion","Source":"./aws-bastion","Dir":"aws-bastion"},{"Key":"eks","Source":"./aws-eks","Dir":"aws-eks"},{"Key":"eks.eks","Source":"registry.terraform.io/terraform-aws-modules/eks/aws","Version":"20.8.4","Dir":".terraform/modules/eks.eks"},{"Key":"eks.eks.eks_managed_node_group","Source":"./modules/eks-managed-node-group","Dir":".terraform/modules/eks.eks/modules/eks-managed-node-group"},{"Key":"eks.eks.eks_managed_node_group.user_data","Source":"../_user_data","Dir":".terraform/modules/eks.eks/modules/_user_data"},{"Key":"eks.eks.fargate_profile","Source":"./modules/fargate-profile","Dir":".terraform/modules/eks.eks/modules/fargate-profile"},{"Key":"eks.eks.kms","Source":"registry.terraform.io/terraform-aws-modules/kms/aws","Version":"2.1.0","Dir":".terraform/modules/eks.eks.kms"},{"Key":"eks.eks.self_managed_node_group","Source":"./modules/self-managed-node-group","Dir":".terraform/modules/eks.eks/modules/self-managed-node-group"},{"Key":"eks.eks.self_managed_node_group.user_data","Source":"../_user_data","Dir":".terraform/modules/eks.eks/modules/_user_data"},{"Key":"vpc","Source":"./aws-vpc","Dir":"aws-vpc"}]}
\ No newline at end of file
+{"Modules":[{"Key":"","Source":"","Dir":"."},{"Key":"bastion","Source":"./aws-bastion","Dir":"aws-bastion"},{"Key":"eks","Source":"./aws-eks","Dir":"aws-eks"},{"Key":"eks.eks","Source":"registry.terraform.io/terraform-aws-modules/eks/aws","Version":"20.8.4","Dir":".terraform/modules/eks.eks"},{"Key":"eks.eks.eks_managed_node_group","Source":"./modules/eks-managed-node-group","Dir":".terraform/modules/eks.eks/modules/eks-managed-node-group"},{"Key":"eks.eks.eks_managed_node_group.user_data","Source":"../_user_data","Dir":".terraform/modules/eks.eks/modules/_user_data"},{"Key":"eks.eks.fargate_profile","Source":"./modules/fargate-profile","Dir":".terraform/modules/eks.eks/modules/fargate-profile"},{"Key":"eks.eks.kms","Source":"registry.terraform.io/terraform-aws-modules/kms/aws","Version":"2.1.0","Dir":".terraform/modules/eks.eks.kms"},{"Key":"eks.eks.self_managed_node_group","Source":"./modules/self-managed-node-group","Dir":".terraform/modules/eks.eks/modules/self-managed-node-group"},{"Key":"eks.eks.self_managed_node_group.user_data","Source":"../_user_data","Dir":".terraform/modules/eks.eks/modules/_user_data"},{"Key":"eks.tf_backend","Source":"../modules/tf-backend","Dir":"modules/tf-backend"},{"Key":"vpc","Source":"./aws-vpc","Dir":"aws-vpc"}]}
\ No newline at end of file
Index: terraform/aws-bastion/main.tf
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>resource \"aws_key_pair\" \"bastion_key\" {\n  key_name   = \"bastion-key\"\n  public_key = file(\"~/.ssh/id_rsa.pub\")\n}\n\nresource \"aws_security_group\" \"bastion_sg\" {\n  name        = \"bastion-sg\"\n  description = \"Allow SSH from my IP\"\n  vpc_id      = var.vpc_id\n\n  ingress {\n    from_port   = 22\n    to_port     = 22\n    protocol    = \"tcp\"\n    cidr_blocks = [var.my_ip]\n  }\n\n  egress {\n    from_port   = 0\n    to_port     = 0\n    protocol    = \"-1\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n}\n\nresource \"aws_instance\" \"bastion\" {\n  ami                    = \"ami-0c101f26f147fa7fd\" # Ubuntu 22.04 us-east-1\n  instance_type          = \"t3.micro\"\n  subnet_id              = var.public_subnet_id\n  key_name               = aws_key_pair.bastion_key.key_name\n  vpc_security_group_ids = [aws_security_group.bastion_sg.id]\n\n  tags = {\n    Name = \"bastion-host\"\n  }\n}\n
===================================================================
diff --git a/terraform/aws-bastion/main.tf b/terraform/aws-bastion/main.tf
--- a/terraform/aws-bastion/main.tf	(revision 5710a9eeb899bce28b058b8b13972471fbc5b073)
+++ b/terraform/aws-bastion/main.tf	(date 1745165990158)
@@ -1,36 +1,10 @@
-resource "aws_key_pair" "bastion_key" {
-  key_name   = "bastion-key"
-  public_key = file("~/.ssh/id_rsa.pub")
-}
-
-resource "aws_security_group" "bastion_sg" {
-  name        = "bastion-sg"
-  description = "Allow SSH from my IP"
-  vpc_id      = var.vpc_id
-
-  ingress {
-    from_port   = 22
-    to_port     = 22
-    protocol    = "tcp"
-    cidr_blocks = [var.my_ip]
-  }
-
-  egress {
-    from_port   = 0
-    to_port     = 0
-    protocol    = "-1"
-    cidr_blocks = ["0.0.0.0/0"]
-  }
-}
-
 resource "aws_instance" "bastion" {
-  ami                    = "ami-0c101f26f147fa7fd" # Ubuntu 22.04 us-east-1
-  instance_type          = "t3.micro"
-  subnet_id              = var.public_subnet_id
-  key_name               = aws_key_pair.bastion_key.key_name
-  vpc_security_group_ids = [aws_security_group.bastion_sg.id]
+  ami           = "ami-0e449927258d45bc4"
+  instance_type = "t2.micro"
+  subnet_id     = aws_subnet.public[0].id
+  key_name      = var.key_name
 
   tags = {
-    Name = "bastion-host"
+    Name = "${var.project}-bastion"
   }
 }
